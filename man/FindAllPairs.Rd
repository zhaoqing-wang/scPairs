% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/find_all_pairs.R
\name{FindAllPairs}
\alias{FindAllPairs}
\title{Discover All Synergistic Gene Pairs in a Single-Cell or Spatial Dataset}
\usage{
FindAllPairs(
  object,
  features = NULL,
  n_top_genes = 2000,
  assay = NULL,
  slot = "data",
  cluster_col = NULL,
  cor_method = c("pearson", "spearman", "biweight"),
  n_mi_bins = 5,
  min_cells_expressed = 10,
  use_prior = TRUE,
  organism = "mouse",
  custom_pairs = NULL,
  use_neighbourhood = TRUE,
  neighbourhood_k = 20,
  neighbourhood_reduction = "pca",
  smooth_alpha = 0.3,
  use_spatial = TRUE,
  spatial_k = 6,
  n_perm = 0,
  weights = NULL,
  top_n = NULL,
  verbose = TRUE
)
}
\arguments{
\item{object}{A Seurat object (scRNA-seq or spatial).}

\item{features}{Character vector of gene names to consider.  NULL (default)
uses Seurat \code{VariableFeatures}; if unavailable, selects the top
\code{n_top_genes} by mean expression.}

\item{n_top_genes}{Integer; maximum number of genes to analyse when
\code{features = NULL}.  Default 2000.}

\item{assay}{Character; assay to use.  Default: \code{DefaultAssay(object)}.}

\item{slot}{Character; data slot.  Default \code{"data"} (log-normalised).}

\item{cluster_col}{Character; column in \code{meta.data} with cluster IDs
(for ratio-consistency).  NULL = use \code{Idents(object)}.}

\item{cor_method}{Character vector; correlation methods to compute.
Default \code{c("pearson", "spearman", "biweight")}.}

\item{n_mi_bins}{Integer; bins for mutual information.  0 = skip MI.}

\item{min_cells_expressed}{Integer; minimum co-expressing cells to keep a
pair. Default 10.  Set to 0 to retain all pairs (recommended when
neighbourhood metrics are enabled).}

\item{use_prior}{Logical; integrate prior knowledge (GO/KEGG pathway
co-annotation and bridge genes).  Default TRUE.  Requires
\code{org.Mm.eg.db} or \code{org.Hs.eg.db} and \code{AnnotationDbi}.}

\item{organism}{Character; \code{"mouse"} or \code{"human"} for prior
knowledge lookup.  Default \code{"mouse"}.}

\item{custom_pairs}{Optional data.frame with columns \code{gene1},
\code{gene2} for user-supplied interactions (CellChatDB, etc.).}

\item{use_neighbourhood}{Logical; compute neighbourhood-aware metrics
(KNN-smoothed correlation, neighbourhood co-expression score, and
cluster-level pseudo-bulk correlation).  Default TRUE.  These metrics
are critical for detecting synergistic pairs where cell-level
co-expression is absent due to sparsity.}

\item{neighbourhood_k}{Integer; number of nearest neighbours for the
neighbourhood graph.  Default 20.}

\item{neighbourhood_reduction}{Character; reduction to use for building the
KNN graph.  Default \code{"pca"}.}

\item{smooth_alpha}{Numeric in [0,1]; self-weight for KNN smoothing.
0 = pure neighbour average, 1 = no smoothing.  Default 0.3.}

\item{use_spatial}{Logical; compute spatial metrics when available.
Default TRUE.}

\item{spatial_k}{Integer; KNN neighbourhood size for spatial analyses.}

\item{n_perm}{Integer; permutations for p-values.  0 = skip (fast mode).}

\item{weights}{Named numeric vector; metric weights for score integration.
NULL = use defaults.}

\item{top_n}{Integer or NULL; return only the top \emph{n} pairs by synergy
score.  NULL = return all.}

\item{verbose}{Logical; print progress.}
}
\value{
A list with class \code{"scPairs_result"} containing:
\describe{
\item{\code{pairs}}{\code{data.table} of gene pairs with all metric columns,
\code{synergy_score}, \code{rank}, \code{p_value} (if permutation), \code{p_adj},
\code{confidence}.}
\item{\code{parameters}}{List of analysis parameters for reproducibility.}
\item{\code{n_genes}}{Number of genes analysed.}
\item{\code{n_cells}}{Number of cells.}
\item{\code{has_spatial}}{Logical; whether spatial metrics were computed.}
}
}
\description{
The primary discovery function of \strong{scPairs}.
Given a Seurat object (scRNA-seq or spatial transcriptomics), \code{FindAllPairs}
identifies statistically significant synergistic gene pairs by integrating
multiple lines of evidence:
\enumerate{
\item \strong{Co-expression} -- Pearson, Spearman, and biweight midcorrelation
capture linear, rank-based, and robust associations.
\item \strong{Mutual information} -- detects non-linear dependencies missed by
correlation.
\item \strong{Ratio consistency} -- tests whether the expression ratio of two genes
is stable across cell clusters, a hallmark of genuine co-regulation.
\item \strong{Spatial co-variation} (spatial data only) -- Lee's L statistic measures
bivariate spatial autocorrelation; the co-location quotient (CLQ) tests
whether expressing cells are spatially attracted.
}

Metrics are rank-normalised and combined via weighted summation.
Optional permutation testing provides empirical p-values.
}
\details{
\strong{Performance (v0.1.1):} All core metric computations are vectorised.
The co-expression filter uses matrix crossproduct, biweight midcorrelation
is computed as a full matrix via vectorised kernel operations, and spatial
metrics use sparse matrix multiplication for the spatial lag.  These changes
yield 5--20x speedups on datasets with >500 genes.
}
\examples{
\dontrun{
# Discover top 100 synergistic pairs (fast, no permutation)
result <- FindAllPairs(seurat_obj, n_top_genes = 500, top_n = 100)
head(result$pairs)

# Full analysis with permutation p-values
result <- FindAllPairs(seurat_obj, n_perm = 999)

# Visualise the network
PlotPairNetwork(result)
}

}
