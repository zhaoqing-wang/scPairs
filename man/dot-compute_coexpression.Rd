% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/coexpression.R
\name{.compute_coexpression}
\alias{.compute_coexpression}
\title{Compute pairwise co-expression metrics for a set of genes}
\usage{
.compute_coexpression(
  mat,
  features,
  cluster_ids = NULL,
  cor_method = c("pearson", "spearman", "biweight"),
  n_mi_bins = 5,
  min_cells_expressed = 10,
  verbose = TRUE
)
}
\arguments{
\item{mat}{Numeric (or sparse) matrix, genes in rows, cells in columns.
Should be log-normalised expression values.}

\item{features}{Character vector of gene names to include (must be rownames
of \code{mat}).}

\item{cluster_ids}{Factor or character vector of cluster assignments,
length = ncol(mat).  Used for ratio-consistency calculation.  NULL to
skip that metric.}

\item{cor_method}{Character vector of correlation types to compute.
Any subset of \code{c("pearson", "spearman", "biweight")}.}

\item{n_mi_bins}{Integer; number of bins for mutual information
discretisation. Set to 0 to skip MI.}

\item{min_cells_expressed}{Integer; minimum number of cells where \emph{both}
genes of a pair must be expressed (> 0) to retain the pair.}

\item{verbose}{Logical; print progress messages.}
}
\value{
A \code{data.table} with columns: \code{gene1}, \code{gene2}, plus any computed
metric columns (\code{cor_pearson}, \code{cor_spearman}, \code{cor_biweight},
\code{mi_score}, \code{ratio_consistency}).
}
\description{
Calculates Pearson correlation, Spearman correlation, biweight
midcorrelation, mutual information (discretised), and expression ratio
consistency across cell clusters.  Designed for speed: uses vectorised
matrix algebra where possible and avoids per-pair loops for correlation.
}
\details{
\strong{Biweight midcorrelation} (Langfelder & Horvath, 2012) is a robust
alternative to Pearson correlation that down-weights outlier observations,
which is particularly valuable for noisy single-cell data.

\strong{Ratio consistency} measures whether the expression ratio of two genes is
stable across clusters: for each cluster the log-ratio median is computed,
and consistency = 1 - CoV of those medians (bounded to [0, 1]).  High
values indicate the two genes maintain a fixed stoichiometric relationship
across cell populations -- a hallmark of genuine co-regulation.

\strong{Mutual information} captures non-linear dependencies missed by
correlation.  Expression values are discretised into equal-frequency bins
and MI is estimated via the plug-in estimator.
}
\keyword{internal}
