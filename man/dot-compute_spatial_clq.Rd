% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/spatial_colocation.R
\name{.compute_spatial_clq}
\alias{.compute_spatial_clq}
\title{Compute co-location quotient (CLQ) for gene pairs in spatial data}
\usage{
.compute_spatial_clq(
  coords,
  mat,
  pair_dt,
  k = 6,
  expr_threshold = 0,
  verbose = TRUE
)
}
\arguments{
\item{coords}{Data.frame with \code{x}, \code{y} columns, rownames = cell barcodes.}

\item{mat}{Expression matrix (genes x cells).}

\item{pair_dt}{\code{data.table} with columns \code{gene1}, \code{gene2}.}

\item{k}{Integer; neighbourhood size.}

\item{expr_threshold}{Numeric; threshold above which a gene is considered
"expressed" in a cell.}

\item{verbose}{Logical.}
}
\value{
The input \code{pair_dt} with added column \code{spatial_clq}.
}
\description{
The co-location quotient measures whether cells expressing gene A are
disproportionately located near cells expressing gene B, relative to a
random spatial arrangement.  CLQ > 1 indicates spatial co-location (the
two expression patterns are spatially attracted); CLQ < 1 indicates spatial
segregation; CLQ = 1 indicates random spatial mixing.
}
\details{
For each cell \emph{i} expressing gene A, we count how many of its \emph{k} nearest
neighbours express gene B, and compare to the global proportion of cells
expressing gene B.  The CLQ is the ratio of observed-to-expected proportions:

\deqn{CLQ_{A \to B} = \frac{1}{N_A} \sum_{i \in A} \frac{n_{iB}/k}{N_B / N}}

where \eqn{N_A} and \eqn{N_B} are numbers of cells expressing A and B,
\eqn{n_{iB}} is the number of B-expressing neighbours of cell \emph{i}, \emph{k} is
the neighbourhood size, and \emph{N} is the total number of cells.

The symmetric CLQ is computed as the geometric mean of \eqn{CLQ_{A \to B}}
and \eqn{CLQ_{B \to A}}.

A binary expression threshold is applied: a cell "expresses" a gene if its
normalised expression exceeds \code{expr_threshold} (default: 0, i.e. any
non-zero count).

\strong{Performance (v0.1.1):} The neighbour expression counts are computed via
matrix multiplication.  For each gene, the binary expression vector is
multiplied against the neighbour indicator matrix to get per-cell counts of
expressing neighbours, replacing the previous nested vapply loops.
}
\references{
Leslie, T.F. & Kronenfeld, B.J. (2011). The colocation quotient: a new
measure of spatial association between categorical subsets of points.
\emph{Geographical Analysis}, 43(3), 306-326.
}
\keyword{internal}
