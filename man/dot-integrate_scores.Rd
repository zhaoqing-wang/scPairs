% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/score_integration.R
\name{.integrate_scores}
\alias{.integrate_scores}
\title{Integrate multi-evidence scores into a composite synergy score}
\usage{
.integrate_scores(
  pair_dt,
  weights = NULL,
  n_perm = 0,
  mat = NULL,
  cluster_ids = NULL,
  coords = NULL,
  spatial_k = 6,
  verbose = TRUE
)
}
\arguments{
\item{pair_dt}{\code{data.table} from \code{.compute_coexpression} and optionally
spatial functions, containing any subset of metric columns.}

\item{weights}{Named numeric vector of metric weights.  Names must match
column names in \code{pair_dt}.  Any missing metric is silently skipped.
Default weights:
* \code{cor_pearson = 1}, \code{cor_spearman = 1}, \code{cor_biweight = 1.5}
* \code{mi_score = 1}, \code{ratio_consistency = 1.2}
* \code{spatial_lee_L = 1.5}, \code{spatial_clq = 1.2}}

\item{n_perm}{Integer; permutations for composite score p-value (0 to skip).}

\item{mat}{Expression matrix (needed for permutation null).}

\item{cluster_ids}{Cluster factor (for permutation null).}

\item{coords}{Spatial coordinates (for spatial permutation null).}

\item{spatial_k}{KNN k for spatial metrics in permutation null.}

\item{verbose}{Logical.}
}
\value{
\code{pair_dt} with added columns:
\itemize{
\item \code{synergy_score} -- composite score in [0, 1].
\item \code{p_value} -- permutation-based p-value (if \code{n_perm > 0}).
\item \code{p_adj} -- BH-adjusted p-value.
\item \code{rank} -- rank by synergy score (1 = strongest).
\item \code{confidence} -- categorical label: "High" (p_adj < 0.01),
"Medium" (< 0.05), "Low" (< 0.1), "NS" otherwise.
}
}
\description{
Combines co-expression metrics (correlation, mutual information, ratio
consistency) and spatial metrics (Lee's L, CLQ) into a single synergy score.
Scores are rank-normalised to [0, 1] before weighted combination so that
different metric scales do not dominate.
}
\details{
An empirical p-value is obtained by permuting cell labels.

\strong{Performance (v0.1.1):} Permutation testing now reuses the vectorised
co-expression and spatial pipelines.  P-values are computed via a single
vectorised comparison instead of per-pair vapply.  The null score matrix
uses \code{colSums(null >= observed)} for batch comparison.
}
\keyword{internal}
