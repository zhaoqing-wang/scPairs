% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compute_metrics.R
\name{.compute_pair_metrics}
\alias{.compute_pair_metrics}
\title{Unified Core Metric Engine for scPairs}
\usage{
.compute_pair_metrics(
  mat,
  pair_dt,
  cluster_ids,
  object,
  mode = c("all", "expression", "prior_only"),
  cor_method = c("pearson", "spearman", "biweight"),
  n_mi_bins = 5,
  min_cells_expressed = 10,
  use_neighbourhood = TRUE,
  neighbourhood_k = 20,
  neighbourhood_reduction = "pca",
  smooth_alpha = 0.3,
  use_prior = TRUE,
  organism = "mouse",
  custom_pairs = NULL,
  use_spatial = TRUE,
  spatial_k = 6,
  n_perm = 0,
  weights = NULL,
  verbose = TRUE
)
}
\arguments{
\item{mat}{Expression matrix (genes x cells, dense or sparse).}

\item{pair_dt}{\code{data.table} with columns \code{gene1}, \code{gene2}.}

\item{cluster_ids}{Factor of cluster assignments.}

\item{object}{Seurat object (needed for KNN graph / embedding).}

\item{mode}{Character; one of \code{"all"} (default), \code{"expression"},
\code{"prior_only"}.}

\item{cor_method}{Character vector of correlation methods.}

\item{n_mi_bins}{Integer; bins for mutual information.}

\item{min_cells_expressed}{Integer; minimum co-expressing cells.}

\item{use_neighbourhood}{Logical; compute neighbourhood metrics.}

\item{neighbourhood_k}{Integer; KNN k.}

\item{neighbourhood_reduction}{Character; reduction for KNN.}

\item{smooth_alpha}{Numeric; self-weight for KNN smoothing.}

\item{use_prior}{Logical; compute prior knowledge metrics.}

\item{organism}{Character; \code{"mouse"} or \code{"human"}.}

\item{custom_pairs}{Optional data.frame of custom interactions.}

\item{use_spatial}{Logical; compute spatial metrics.}

\item{spatial_k}{Integer; spatial neighbourhood k.}

\item{n_perm}{Integer; permutations for score integration.}

\item{weights}{Named numeric; metric weights.}

\item{verbose}{Logical.}
}
\value{
A list with:
\describe{
\item{\code{pair_dt}}{Updated \code{data.table} with all metric columns.}
\item{\code{prior_net}}{Prior network object (if computed).}
\item{\code{W}}{KNN weight matrix (if computed).}
\item{\code{has_spatial}}{Logical.}
\item{\code{has_neighbourhood}}{Logical.}
}
}
\description{
Shared computation backbone invoked by all three discovery functions
(\code{FindAllPairs}, \code{FindGenePairs}, \code{AssessGenePair}).
Accepts a pre-built pair table and computes the requested metric layers
(expression, neighbourhood, prior knowledge, spatial) on demand.

Users control which layers to compute via dedicated flags.  When
\code{mode = "prior_only"}, only prior knowledge metrics are returned; when
\code{mode = "expression"}, only expression-based metrics are computed; the
default \code{mode = "all"} computes every available layer.
}
\keyword{internal}
