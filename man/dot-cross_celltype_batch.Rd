% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cross_celltype.R
\name{.cross_celltype_batch}
\alias{.cross_celltype_batch}
\title{Compute cross-cell-type interaction scores for gene pairs}
\usage{
.cross_celltype_batch(
  mat,
  pair_dt,
  cluster_ids,
  embed,
  n_bins = 50,
  min_cells_per_bin = 5,
  min_bins = 8
)
}
\arguments{
\item{mat}{Expression matrix (genes x cells, dense or sparse).}

\item{pair_dt}{\code{data.table} with columns \code{gene1}, \code{gene2}.}

\item{cluster_ids}{Factor of cell-type / cluster assignments.}

\item{embed}{Numeric matrix of PCA embedding (n_cells x n_dims).}

\item{n_bins}{Integer; number of micro-environment bins.  Default 50.}

\item{min_cells_per_bin}{Integer; minimum cells of a given type in a bin
for that bin to contribute to the correlation.  Default 5.}

\item{min_bins}{Integer; minimum bins with both types present to compute
a correlation for a given cell-type pair.  Default 8.}
}
\value{
Numeric vector of cross-cell-type interaction scores (one per row
of \code{pair_dt}).
}
\description{
For each gene pair (A, B), this metric measures whether expression of
gene A in cells of one type correlates with expression of gene B in
cells of a \emph{different} type that share the same tissue micro-environment.
}
\section{Algorithm}{

\enumerate{
\item Partition all cells into micro-environment bins using k-means on the
PCA embedding.  Each bin represents a local tissue context containing
cells of multiple types.
\item For each cell-type pair (type_i, type_j, i != j), compute pseudo-bulk
expression per bin: mean(gene_A) in type_i cells of that bin and
mean(gene_B) in type_j cells of that bin.
\item Correlate the paired pseudo-bulk vectors across bins (Pearson r).
This gives the directed score A -> B.
\item Repeat for B -> A.
\item Aggregate across all cell-type pairs using a weighted mean (weighted
by number of bins with sufficient cells of both types).
\item Final score = geometric mean of |aggregated r(A->B)| and
|aggregated r(B->A)|.
}
}

\keyword{internal}
