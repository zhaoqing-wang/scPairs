% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cross_celltype.R
\name{.cross_celltype_batch}
\alias{.cross_celltype_batch}
\title{Compute cross-cell-type interaction scores for gene pairs}
\usage{
.cross_celltype_batch(mat, pair_dt, W, cluster_ids, min_cross_pairs = 30)
}
\arguments{
\item{mat}{Expression matrix (genes x cells, dense or sparse).}

\item{pair_dt}{\code{data.table} with columns \code{gene1}, \code{gene2}.}

\item{W}{Sparse KNN weight matrix (n_cells x n_cells), row-standardised.}

\item{cluster_ids}{Factor of cell-type / cluster assignments (one per cell).}

\item{min_cross_pairs}{Integer; minimum number of cross-type neighbour
pairs required to compute a correlation.
Pairs with fewer observations get NA.  Default 30.}
}
\value{
Numeric vector of cross-cell-type interaction scores (one per row
of \code{pair_dt}).
}
\description{
For each gene pair (A, B), this metric measures whether expression of
gene A in cells of one type correlates with expression of gene B in
neighbouring cells of a \emph{different} type.
}
\section{Algorithm}{

\enumerate{
\item Build a KNN graph (from PCA embedding or spatial coordinates).
\item For each cell \eqn{i} of type \eqn{c_i}, identify its neighbours
that belong to a \emph{different} cell type \eqn{c_j \neq c_i}.
\item For each such cross-type neighbour \eqn{j}, record the pair
\eqn{(expr_A(i),\; expr_B(j))}.
\item Compute the Pearson correlation of these cross-type expression
pairs.  This gives the directed score \eqn{A \to B} ("gene A in
the source cell, gene B in the neighbour").
\item Repeat for the reverse direction \eqn{B \to A}.
\item The final score is the geometric mean of the absolute values:
\deqn{cross\_celltype\_score = \sqrt{|r_{A \to B}| \times |r_{B \to A}|}}
}

A high score indicates that expression of gene A in one cell type
\emph{systematically} co-varies with expression of gene B in a
neighbouring cell type, consistent with trans-cellular signalling
or paracrine co-regulation.
}

\keyword{internal}
