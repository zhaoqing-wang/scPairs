% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/neighbourhood.R
\name{.neighbourhood_coexpr_batch}
\alias{.neighbourhood_coexpr_batch}
\title{Neighbourhood co-expression score for gene pairs}
\usage{
.neighbourhood_coexpr_batch(mat, pair_dt, W, expr_threshold = 0)
}
\arguments{
\item{mat}{Expression matrix (genes x cells, dense).}

\item{pair_dt}{data.table with gene1, gene2.}

\item{W}{KNN weight matrix (row-standardised).}

\item{expr_threshold}{Numeric; expression above this is "expressed".}
}
\value{
Numeric vector of NCS values.
}
\description{
For each cell expressing gene A, we compute the fraction of its k
neighbours that express gene B (and vice versa).  The neighbourhood
co-expression score is the geometric mean of the two directional
enrichments:
}
\details{
\deqn{NCS_{A \to B} = \frac{\text{mean}(\text{neigh\_B\_frac for A-cells})}
                             {\text{global\_frac\_B}}}
\deqn{NCS = \sqrt{NCS_{A \to B} \cdot NCS_{B \to A}}}

A score > 1 indicates that expressing cells of one gene tend to have
neighbours expressing the other gene more than expected by chance.
}
\keyword{internal}
